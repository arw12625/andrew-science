POST_DIR := $(CURDIR)

POST_MD := $(POST_ID).md
POST_J2 := $(SITE_DIR)/$(POST_ID).j2
POST_TEMPLATE_J2 := $(TEMPLATE_DIR)/post.j2
POST_HTML := $(BUILD_DIR)/$(POST_ID).html
POST_DEPS := $(POST_J2) $(POST_TEMPLATE_J2) $(addprefix $(TEMPLATE_DIR)/,head.j2 header.j2 footer.j2)

RENDER_POST = $(PYTHON_COMMAND) $(BUILD_SCRIPTS)/renderPost.py
RENDER_POST_DEPS = $(BUILD_SCRIPTS)/renderPost.py $(BUILD_SCRIPTS_DEPS)

all: $(POST_HTML)

.PHONY: all clean

clean:
	@echo Cleaning $(POST_ID)

# Use jinja2 to build the html for this post
$(POST_HTML): $(POST_DEPS) $(RENDER_POST_DEPS)
	$(RENDER_POST) $(PAGE_ID) $(POST_ID) $(POST_TEMPLATE_J2) $(POST_HTML)

# Convert markdown into html input to jinja2
$(POST_J2): $(POST_MD) $(MARKDOWN_DEPS)
	$(MARKDOWN) $(POST_MD) $(POST_J2)
